import React, { useState, useEffect } from 'react'
import {Hosts} from '../../../pages/List'
import api from '../../../services/api'

import {FaUserCog} from 'react-icons/fa';
import {RiCloseCircleFill} from 'react-icons/ri';

import './styles.css';

interface Props{
    idHost: number
}

interface HostInfors extends Hosts{
  vuln: number[],
  vuln_fixed: number[]
}

const ModalInforsHost: React.FC<Props> = ({idHost}) => {
    
    const [hostInfors, setHostInfors] = useState<HostInfors>()

   function handleDetailsHost(idHost: number){
        if(idHost !== 0){
            api.get(`/api/assets/${idHost}/`).then(response => {
                setHostInfors(response.data)
                
            })
        }
    }

    useEffect(() => {
       handleDetailsHost(idHost);
    }, [idHost])

   async function modifiedStatusVulnerability(vulnerability: number,status: number){
        await api.patch(`http://167.114.135.109/api/vulnerability/${vulnerability}/asset/${idHost}/update`,{status})
        handleDetailsHost(idHost);
    }


    return(
        <div className="modal fade" id="ModalInforsHost" tabIndex = {-1} aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div className="modal-dialog modal-lg">
                <div className="modal-content">
                    <div className="modal-header">
                        <FaUserCog size = 'calc(1vw + 1em)' color = '#6600ff'/>

                        <h5 className="modal-title" id="exampleModalLabel">
                            {hostInfors?.hostname}
                        </h5>

                        <button type="button" className="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"><RiCloseCircleFill color = '#6600ff' /></span>
                        </button>
                    </div>

                    <div className="modal-body">
                        <fieldset>
                            <p>Active vulnerabilities</p>
                            <div className = 'container-vulnerabilities'>
                                {hostInfors?.vuln.map(vulnerability => (
                                    <span 
                                    onClick = {() => modifiedStatusVulnerability(vulnerability, 0)}
                                    key = {vulnerability} 
                                    className = 'box-vulnerability'
                                    style = {{backgroundColor: 'orange'}}>{vulnerability}</span>
                                ))}
                            </div>
                        </fieldset>

                        <fieldset>
                            <p>Inactive vulnerabilities</p>
                            <div className = 'container-vulnerabilities'>
                                {hostInfors?.vuln_fixed.map(vulnerability => (
                                    <span 
                                        onClick = {() => modifiedStatusVulnerability(vulnerability, 1)}
                                        key = {vulnerability}
                                        className = 'box-vulnerability'
                                        style = {{backgroundColor: '#6600ff'}}>
                                        
                                        {vulnerability}
                                    </span>
                                ))}
                            </div>
                        </fieldset>
                    </div>

                </div>
            </div>
        </div>
    )
}

export default ModalInforsHost;