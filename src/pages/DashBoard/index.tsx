import React, { useState, useEffect } from 'react';

import ContainerGraphics from '../../components/ContainerGraphics'; //Container dos gráficos
import ContainerCardDashBoard from '../../components/ContainerCardDashBoard'; //Container dos cards
import LinkNavigation from '../../components/LinkNavigation'; //Link para outra página

//Ícones
import {FaUserFriends,FaUserShield} from 'react-icons/fa';
import {TiWarning} from 'react-icons/ti';
import {BiTargetLock} from 'react-icons/bi';
import {RiSkullFill} from 'react-icons/ri';
import {AiFillHome} from 'react-icons/ai';

//----
import api from '../../services/api';

import Graphics from '../../components/Graphics' //Classe com os gráficos 

import './styles.css';

const DashBoard = () => {
    const [totalHosts, setTotalHosts] = useState(0) //Estado com total de hosts
    const [vulnerableHosts, setVulnerableHosts] = useState(0) //Estado com total de hosts vulneráveis
    const [totalVulnerabilities, setTotalVulnerabilities] = useState(0) //Estado com total de vulnerabilidades
    const [unpatchedVulnerabilities, setUnpatchedVulnerabilities] = useState(0) //Estado com total de vulnerabilidades ativas
    const [mediaRiskHost, setMediaRiskHost] = useState(0); //Estado com média de risco dos hosts

    //Requisição de dados para o primeiro card
    useEffect(() => {
        api.get('/api/dashboard/cards/asset').then(response => {
            setTotalHosts(response.data.asset_count)
            setVulnerableHosts(response.data.vulnerable_asset_count)
        })
    }, [])

    //Constrúindo gráficos após renderização do componente
    useEffect(() => {
        const graphic = new Graphics();
        graphic.vulnerabilitiesUnpatchedBySeverity();
        graphic.Top10HostsMoreVulnerables();
    }, [])

    //Requisição de dados para o segundo card
    useEffect(() => {

        api.get('/api/dashboard/cards/vulnerability').then(response => {
            
            setTotalVulnerabilities(response.data.vuln_count)
            setUnpatchedVulnerabilities(response.data.active_vuln_count)
        })
    }, [])

    //Requisição de dados para o terceiro card
    useEffect(() => {
        api.get('/api/dashboard/cards/risk').then(response => {
            setMediaRiskHost(response.data.risk_avg)
        })
    }, [])

    return(
        <div className = 'dashboard-container'>
                
                <LinkNavigation textLink = 'Home' urlLink = '/List' IconLink = {AiFillHome} />
        

                <nav>
                   <ContainerCardDashBoard>
                       <fieldset>
                          
                            <p>Total de hosts</p>
                            
                            <div className = 'group-data'>
                                    <FaUserFriends size = '35' color = '#6600ff'/>
                                    
                                    <strong style = {{color: '#6600ff'}}>{totalHosts}</strong>
                            </div>

                            <p>Hosts vulneráveis</p>

                            <div className = 'group-data'>
                                    <FaUserShield size = '35' color = '#cc3333'/>
                                    <strong style = {{color: '#cc3333'}}>{vulnerableHosts}</strong>
                            </div>
                       </fieldset>
                      
                   </ContainerCardDashBoard>


                   <ContainerCardDashBoard >
                        <fieldset>
                            
                            <p>Total de vulnerabilidades</p>
                            
                            <div className = 'group-data'>
                                    <BiTargetLock size = '35' color = '#6600ff'/>
                                    
                                    <strong style = {{color: '#6600ff'}}>{totalVulnerabilities}</strong>
                            </div>

                            <p>Vulnerabilidades ativas</p>

                            <div className = 'group-data'>
                                    <TiWarning size = '35' color = '#ff6600'/>
                                    <strong style = {{color: '#ff6600'}}>{unpatchedVulnerabilities}</strong>
                            </div>
                        </fieldset>
                        
                   </ContainerCardDashBoard>

                   <ContainerCardDashBoard>
                        <fieldset>
                            
                            <p>Média de risco dos hosts</p>
                            
                            <div className = 'group-data'>
                                    <RiSkullFill size = '35' color = '#ff6600'/>
                                    <strong style = {{color: '#ff6600'}}>{mediaRiskHost}</strong>
                            </div>

                        </fieldset>
                   </ContainerCardDashBoard>

               </nav>
                
               <main>
                   
                   <ContainerGraphics idGraphics = 'graphicHosts' />

                   <ContainerGraphics idGraphics = "graphicVulnerabilities" />

               </main>
        </div>
    )
}

export default DashBoard;