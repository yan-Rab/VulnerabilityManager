import React, { useState, useEffect } from 'react';

import ContainerGraphics from '../../components/ContainerGraphics';
import ContainerHeaderDashBoard from '../../components/ContainerHeaderDashBoard';
import {FaUserFriends,FaUserShield} from 'react-icons/fa';
import {TiWarning} from 'react-icons/ti';
import {BiTargetLock} from 'react-icons/bi';
import {RiSkullFill} from 'react-icons/ri';
import {AiFillHome} from 'react-icons/ai';

import api from '../../services/api';
import Graphics from '../../components/Graphics'
import './styles.css';
import LinkNavigation from '../../components/LinkNavigation';

const DashBoard = () => {
    const [totalHosts, setTotalHosts] = useState(0)
    const [vulnerableHosts, setVulnerableHosts] = useState(0)
    const [totalVulnerabilities, setTotalVulnerabilities] = useState(0)
    const [unpatchedVulnerabilities, setUnpatchedVulnerabilities] = useState(0)
    const [mediaRiskHost, setMediaRiskHost] = useState(0);


    useEffect(() => {
        api.get('/api/dashboard/cards/asset').then(response => {
            setTotalHosts(response.data.asset_count)
            setVulnerableHosts(response.data.vulnerable_asset_count)
        })
    }, [])

    useEffect(() => {
        const graphic = new Graphics();
        graphic.vulnerabilitiesUnpatchedBySeverity();
        graphic.Top10HostsMoreVulnerables();
    }, [])
    useEffect(() => {

        api.get('/api/dashboard/cards/vulnerability').then(response => {
            
            setTotalVulnerabilities(response.data.vuln_count)
            setUnpatchedVulnerabilities(response.data.active_vuln_count)
        })
    }, [])

    useEffect(() => {
        api.get('/api/dashboard/cards/risk').then(response => {
            setMediaRiskHost(response.data.risk_avg)
        })
    }, [])

    return(
        <div className = 'dashboard-container'>
                
                <LinkNavigation textLink = 'Home' urlLink = '/List' IconLink = {AiFillHome} />
        

                <nav>
                   <ContainerHeaderDashBoard>
                       <fieldset>
                          
                            <p>Total de hosts</p>
                            
                            <div className = 'group-data'>
                                    <FaUserFriends size = '35' color = '#6600ff'/>
                                    
                                    <strong style = {{color: '#6600ff'}}>{totalHosts}</strong>
                            </div>

                            <p>Hosts vulneráveis</p>

                            <div className = 'group-data'>
                                    <FaUserShield size = '35' color = '#cc3333'/>
                                    <strong style = {{color: '#cc3333'}}>{vulnerableHosts}</strong>
                            </div>
                       </fieldset>
                      
                   </ContainerHeaderDashBoard>


                   <ContainerHeaderDashBoard >
                        <fieldset>
                            
                            <p>Total de vulnerabilidades</p>
                            
                            <div className = 'group-data'>
                                    <BiTargetLock size = '35' color = '#6600ff'/>
                                    
                                    <strong style = {{color: '#6600ff'}}>{totalVulnerabilities}</strong>
                            </div>

                            <p>Vulnerabilidades ativas</p>

                            <div className = 'group-data'>
                                    <TiWarning size = '35' color = '#ff6600'/>
                                    <strong style = {{color: '#ff6600'}}>{unpatchedVulnerabilities}</strong>
                            </div>
                        </fieldset>
                        
                   </ContainerHeaderDashBoard>

                   <ContainerHeaderDashBoard>
                        <fieldset>
                            
                            <p>Média de risco dos hosts</p>
                            
                            <div className = 'group-data'>
                                    <RiSkullFill size = '35' color = '#ff6600'/>
                                    <strong style = {{color: '#ff6600'}}>{mediaRiskHost}</strong>
                            </div>

                        </fieldset>
                   </ContainerHeaderDashBoard>

               </nav>
                
               <main>
                   <ContainerGraphics>
                        <div id="graphicHosts" className = 'graphic'>

                        </div>
                        
                   </ContainerGraphics>

                   <ContainerGraphics >
                        <div id="graphicVulnerabilities" className = 'graphic'>

                        </div>
                   </ContainerGraphics>
               </main>
        </div>
    )
}

export default DashBoard;